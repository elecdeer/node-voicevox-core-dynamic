services:
  e2e-test:
    platform: ${DOCKER_DEFAULT_PLATFORM:-linux/arm64}
    build:
      context: .
      dockerfile: Dockerfile.e2e
      args:
        VOICEVOX_CORE_VERSION: ${VOICEVOX_CORE_VERSION:-0.16.4}
    volumes:
      # 出力ディレクトリをマウント（テスト結果のWAVファイル確認用）
      - ./output:/app/output
      # e2eディレクトリをマウント（スナップショットファイル保存用）
      - ./e2e:/app/e2e
    environment:
      - NODE_ENV=test
      - VOICEVOX_CORE_C_API_PATH=/opt/voicevox/lib/libvoicevox_core.so
      - VOICEVOX_ONNXRUNTIME_PATH=/opt/voicevox/lib/libvoicevox_onnxruntime.so
      - VOICEVOX_OPEN_JTALK_DICT_DIR=/opt/voicevox/dict
      - VOICEVOX_MODELS_PATH=/opt/voicevox/models
      - OUTPUT_DIR=/app/output
